<!-- array title only if the array is empty -->
<label *ngIf="to.label && formControl.length === 0">
  <!-- add button only if the max is not reached -->
  <button *ngIf="canAdd()" (click)="add(0)" class="btn btn-light bg-white mr-2">
    <i class="fa fa-plus"></i>
  </button>
  <span [tooltip]="to.description">{{ to.label }}</span>
</label>

<!--  validation error message -->
<div class="alert alert-danger" role="alert" *ngIf="showError && formControl.errors">
  <formly-validation-message [field]="field"></formly-validation-message>
</div>

<!-- for each item -->

<ng-container *ngFor="let f of field.fieldGroup; let i = index">
  <!-- put title with menu section for item object -->
  <div *ngIf="isChildrenObject()">
    <app-dropdown-label-editor [field]="f" [canAdd]="canAdd()" (addClicked)="add(i + 1)">
      <ng-container *ngIf="f.type === 'object'">
        <ng-container *ngFor="
            let fChildren of f.fieldGroup;
            let first = first;
            let last = last
          ">
          <h6 *ngIf="first" class="dropdown-header">Add fields</h6>
          <button *ngIf="fChildren.hide" class="dropdown-item" (click)="fChildren.hide = false" type="button">
            {{ fChildren.templateOptions.label }}
          </button>
          <div *ngIf="last" class="dropdown-divider"></div>
        </ng-container>
      </ng-container>
      <a class="dropdown-item disabled" href="/cataloging/help">
        Help
      </a>
    </app-dropdown-label-editor>

    <!--  object validation error message -->
    <div class="alert alert-danger" role="alert" *ngIf="f.options.showError && f.formControl.errors">
      <formly-validation-message [field]="f"></formly-validation-message>
    </div>
  </div>

  <!-- all kind of item -->
  <div class="d-flex mb-2" [ngClass]="{ 'pl-4 object-block': isChildrenObject() }">
    <!-- add button -->
    <ng-container *ngTemplateOutlet="addButton; context: { $implicit: i }"></ng-container>

    <!-- item itself -->
    <div class="flex-grow-1">
      <formly-field [field]="f"></formly-field>
    </div>
    <!-- remove button -->
    <ng-container *ngTemplateOutlet="removeButton; context: { $implicit: i }"></ng-container>

  </div>
</ng-container>

<!-- TEMPLATES -->
<!-- dropdown menu -->
<ng-template #menu let-f>
  <app-dropdown-label-editor [field]="f" [canAdd]="false">
    <ng-container *ngIf="f.type === 'object'">
          <!-- section header -->
    <ng-container *ngTemplateOutlet="hasMenu(f) ? menu : title; context: { f: f }">
      </ng-container>

      <ng-container *ngFor="
              let fChildren of hiddenFieldGroup(f.fieldGroup);
              let first = first;
              let last = last
            ">
        <h6 *ngIf="first" class="dropdown-header">Add fields</h6>
        <button *ngIf="fChildren.hide" class="dropdown-item" (click)="show(fChildren)" type="button">
          {{ fChildren.templateOptions.label }}
        </button>
        <div *ngIf="last && f.templateOptions.helpURL" class="dropdown-divider"></div>
      </ng-container>
    </ng-container>

    <a *ngIf="f.templateOptions.helpURL" class="dropdown-item" [href]="f.templateOptions.helpURL" translate>
      Help
    </a>
  </app-dropdown-label-editor>
</ng-template>

<!-- section title -->
<ng-template #title let-f>
  <span [id]="f.id">{{ f.templateOptions.label }}</span>
</ng-template>

<!-- add button -->
<ng-template #addButton let-i>
  <button *ngIf="!isChildrenObject() && canAdd()" (click)="add(i + 1)" class="btn btn-light bg-white mr-2">
    <i class="fa fa-plus"></i>
  </button>
</ng-template>

<!-- tash button -->
<ng-template #removeButton let-i>
  <button (click)="remove(i)" *ngIf="canRemove()" class="btn btn-outline-secondary ml-1"
    [ngClass]="{ 'mb-2': isChildrenObject() }">
    <i class="fa fa-trash"></i>
  </button>
</ng-template>
